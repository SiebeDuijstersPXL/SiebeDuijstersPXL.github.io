<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirectingg...</title>
    <script>
    //window.location.href = "http://18.191.133.143/home"; //ip us-east-2 = good
    //window.location.href = "http://34.200.224.166/home"; //ip us-east-1 = bad

        async function checkRegion() {
            try {
                // Check US-EAST-2 first
                let response = await fetch("http://18.191.133.143/health", { mode: 'no-cors' });
                if (response.ok || response.type === "opaque") {
                    window.location.href = "http://18.191.133.143/home";
                    return;
                }
            } catch (e) {
                console.log("us-east-1 is down, trying us-east-2...");
            }

            try {
                // If us-east-2 fails, try us-east-1
                let response2 = await fetch("SNB4App-Frontend-ALB-2094695776.us-east-1.elb.amazonaws.com/health", { mode: 'no-cors' });
                if (response2.ok || response2.type === "opaque") {
                    window.location.href = "SNB4App-Frontend-ALB-2094695776.us-east-1.elb.amazonaws.com";
                    return;
                }
            } catch (e) {
                console.log("Both regions are down!");
                document.body.innerHTML = "<h1>Sorry, the service is currently unavailable.</h1>";
            }
        }

        checkRegion();
    </script>
</head>

</html>
<!--  <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting...</title>
    <script>
        const servers = {
            "us-east-1": "http://34.200.224.166",
            "us-east-2": "http://18.191.133.143"
        };

        async function testLatency(url) {
            let start = performance.now();
            try {
                await fetch(url + "/health", { mode: 'no-cors' });
                return performance.now() - start;
            } catch (e) {
                return Infinity; // If the request fails, assume high latency
            }
        }

        async function routeUser() {
            let latencies = await Promise.all([
                testLatency(servers["us-east-1"]),
                testLatency(servers["us-east-2"])
            ]);

            let preferredRegion = latencies[0] < latencies[1] ? "us-east-1" : "us-east-2";
            let backupRegion = preferredRegion === "us-east-1" ? "us-east-2" : "us-east-1";

            if (latencies[0] === latencies[1]) {
                preferredRegion = Math.random() > 0.5 ? "us-east-1" : "us-east-2"; // Random if equal
            }

            if (latencies[preferredRegion === "us-east-1" ? 0 : 1] !== Infinity) {
                window.location.href = servers[preferredRegion];
            } else if (latencies[backupRegion === "us-east-1" ? 0 : 1] !== Infinity) {
                window.location.href = servers[backupRegion];
            } else {
                document.body.innerHTML = "<h1>All regions are down! Try again later.</h1>";
            }
        }

        routeUser();
    </script>
</head>
<body> -->
<!--     <h2>Testing server latency...</h2>
</body>
</html> -->
